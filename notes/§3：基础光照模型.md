---
attachments: [Clipboard_2021-07-17-15-50-30.png]
tags: [Unity Shader]
title: §3：基础光照模型
created: '2021-07-17T07:40:34.804Z'
modified: '2021-08-29T15:22:43.673Z'
---

# §3：基础光照模型
## 人眼看到世界的方式
### 光源(Light Source)
光从光源中发射出来，照到物体表面。Unity中，当我们选择创建光源时，有以下四种选项(反射球暂时先不考虑)：
![](@attachment/Clipboard_2021-07-17-15-50-30.png)

### 辐照度(Irradiance)
衡量一个光源发出的光的多少使用的单位是辐照度。
- 对于平行光，辐照度可以通过计算垂直于光源方向l的单位面积上单位时间内穿过的能量得到
- 而存在一定夹角的时候，可以通过求光源方向l和法线之间的夹角的余弦值求得
当光线间隔相同时，光与平面的夹角越大，单位面积内光的数量越少

### 吸收和散射
光与物体相交有两个结果：散射和吸收
- 散射(Scattering)
散射只改变光的方向，但不改变光的颜色和密度
散射分为折射(Refraction)和反射(Reflection)。对于不透明物体，折射进入物体内部的光线还会据徐与内部的颗粒进行相交，其中一些光效最后会重新发射出物体表面，而另一些则会被物体吸收。反射则在物体表面直接被弹出来了
针对散射的两种性状，我们有漫反射(Diffuse)模型与高光反射(Specular)模型
- 吸收(Absorption)
吸收只改变光线的密度和颜色，不改变光线的方向

#### 出射度(Exitance)
衡量出射光线的数量和方向的量

### 着色(Shading)
着色指的是根据材质属性、光源信息去使用一个等式计算沿某个观察方向的出射度的过程。这个等式就是“光照模型(Light Model)”

<br>

## 标准光照模型
标准光照模型只关注直接光照(Direct Light)，也就是**从光源出发，照射到物体表面，反射回摄像机**的光线。
进入摄像机的光线(符号：c~光线类型~)往往分为以下四种：
#### **自发光(Emissive)**
  用于描述给定一个方向时物体本身能向该方向发射多少辐射量。
  自发光指一个物体材质本身会发光，光照射到摄像机中，所以标准光照模型中，自发光就等同于材质(metrail)的自发光颜色
  $$c_{emissive} = m_{emissive}$$
  让自发光产生照亮其他物体效果的前提是使用全局光照模型，否则只是自己看起来更亮了而已

#### **高光反射(Specular)**
用于描述当光线照射到物体表面，物体表面会在**完全镜面反射方向**散射多少辐射量
高光反射需要知道四个向量的值，即视角方向(v)、法线方向(n)、光源方向(入射光l)、反射方向(出射光r)
>- Phong模型
Phong模型和物理中的光学模型类似，主要特征是入射光 $\hat{l}$ 与出射光 $\hat{r}$ 和法线 $\hat{n}$ 的夹角相同。 $\hat{r}$ 的计算公式为：
$$\hat{r} = 2(\hat{n} \cdot \hat{l}) \hat{n} - \hat{l}$$
高光反射光的计算公式为( $m_{gloss}$ 为材质光泽度，值越大材质光斑越小。max的作用是防止负数出现，避免背后的光照亮物体)：
$$c_{specular} = (c_{light} \cdot m_{specular})max(0, \hat{v} \cdot \hat{r})^{m_{gloss}}$$
>- Blinn模型
Blinn模型对Phong模型进行了简化，引入了一个新的矢量 $\hat{h}$ 代替反射光线。 $\hat{h}$ 是对 $\hat{v}$ 和 $\hat{l}$ 取平均再统一化得到的：
$$\hat{h} = \frac{\hat{v} + \hat{l}}{\vert \hat{v} + \hat{l}\vert }$$
高光反射光的计算公式为:
$$c_{specular} = (c_{light} \cdot m_{specular})max(0, \hat{n} \cdot \hat{h})^{m_{gloss}}$$

当摄像机无穷远时，我们认为 $\hat{v}$ 和 $\hat{l}$ 均为定值，此时 $\hat{h}$ 为定值，使用Blinn模型的速度将更快。而当 $\hat{v}$ 和 $\hat{l}$ 处在变化之中时，Phong模型更占优势。此外，一些适合Blinn模型更符合实验结果。因此具体选择哪种攻击计算高光反射需要依效果而定

#### **漫反射(Diffuse)**
用于描述当光线照射到物体表面，物体表面会向**每个方向**散射多少辐射量
对于漫反射而言，观察角度并不重要，因为我们默认漫反射在各个方向的分布是一样的。但是入射光线非常重要。
漫反射符合兰伯特定律(Lambert's law)：
$$c_{diffuse} = (c_{light} \cdot m_{diffuse})max(0, \hat{n} \cdot \hat{l})$$
其中，$\hat{n}$ 为法线向量(normal vector, 一般用n表示)，$\hat{l}$ 为光源的单位矢量，$m_{diffuse}$ 就是材质的漫反射颜色，$c_{light}$ 是光源颜色

#### **环境光(Ambient)**
用于描述其他所有的间接光照
用于模拟间接光照，是一个全局(goble)变量，一个场景中所有物体都使用这个环境光
$$c_{ambient} = g_{ambient}$$

### 应用
基础光照模型常应用于frag的逐像素光照(per-pixel lighting)或vert的逐顶点光照(per-vertex lighting)
> 应用于frag时，我们针对每个像素取法线进行光照运算，这种着色方式被称为Phong着色(于Phong模型不同)
应用于vert时，我们针对每个顶点取法线进行光照运算，这种着色方式被成为高洛德着色(Gouraud Shading)

由于顶点数量远少于像素数量，所以vert的计算量比frag小，但是vert依赖于线性插值(Lerp)，可能会导致光照模型中的非线性运算影响到实际输出效果

<br>

***
## Shader函数学习：normalize与saturate
- normalize()
该函数能将输入的参数转化为长度为1的单位向量，不改变输入参数的方向。输入的参数不仅可以是float，也可以是vec2、vec3等
- saturate()
该函数能将输入的数映射到[0, 1]围内，常用于颜色等限制分量范围在[0, 1]内的参数






