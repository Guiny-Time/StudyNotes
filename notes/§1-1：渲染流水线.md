---
tags: [图形学]
title: §1-1：渲染流水线
created: '2021-07-13T06:18:13.577Z'
modified: '2021-07-13T16:12:41.532Z'
---

# §1-1：渲染流水线

## 渲染流水线的整体流程
分为三个主要的阶段：
- 应用阶段
>- 准备好场景数据
>- 进行**颗粒度剔除(Culling)**
>- 设置和渲染状态(进行渲染设置)
>- **输出渲染图元(Rendering Primitives)**作为几何阶段的输入

- 几何阶段
>- 逐顶点操作(顶点着色器)
>- 曲面细分(曲面细分着色器)
>- 逐多边形操作(几何着色器)
>- 顶点裁剪(删掉屏幕外的部分)
>- 屏幕映射(输出二维坐标)
>- **输出屏幕空间的顶点信息**为光栅化阶段的输入

- 光栅化阶段
>- 三角形(点/线)设置(将二维坐标组装成三角形)
>- 三角形遍历
>- 片元着色器
>- 逐片元操作

- 后处理
>- 简单来说就是后期处理

### 应用阶段
处理场所：CPU
主要流程：颗粒度剔除等操作--->加载数据到显存--->设置渲染状态--->调用DrawCall
#### 粗粒度剔除
指的是被遮挡住或者在屏幕外的不在摄像机范围内不需要被渲染的元素。对他们进行渲染是浪费时间的，所以要先剔除掉这部分元素
#### 加载数据到显存
在应用阶段，数据会先从硬盘加载到RAM中，随后网格、纹理等数据又被加载到显存上。加载到显存上之后，数据就会被移除
之所以这么做是因为GPU访问显存的速度比访问前两者更快，而且多数显卡可能无法直接访问RAM
#### 设置渲染状态
就是针对不同的网格，使用不同的顶点着色器(Vertex Shader)、不同的片元着色器(Fragment Shader)、不同的纹理进行渲染，是渲染的准备工作
#### 调用DrawCall
DrawCall本质上是CPU向GPU传递的命令，CPU告诉GPU下一个渲染谁，GPU接收命令之后开始渲染

### 几何阶段
处理场所：GPU
主要流程：顶点着色--->可选处理--->裁剪--->屏幕映射
#### 顶点着色
顶点着色使用了顶点着色器，顶点着色器对每个顶点进行操作，但不知道顶点之间彼此的联系，这一阶段十分快速
顶点着色器主要的两个功能是**坐标变换**和**逐顶点光照**
- 坐标变换
将顶点的模型坐标转换到齐次裁剪空间，再由硬件做透视除法后最终得到设备坐标
- 逐顶点光照
计算输出顶点的颜色
#### 可选处理
主要是几种着色器的选择。它们不是必须的。
- 曲面细分着色器(Tessellation Shader)
用于细分图元
- 几何着色器(Geometry Shader)
用于逐图元着色或产生更多的图元
#### 裁剪(Clipping)
针对部分在摄像机范围外的图形进行裁剪的处理，使用一些新的顶点来代替被裁剪的部分
这样能节省资源，你可以自定义裁剪配置以获得最优化体验
#### 屏幕映射(Screen Mapping)
屏幕映射将每个图元的x、y坐标转换到屏幕坐标系(Screen Coordinates, 并不考虑z轴，因为屏幕是二维的，没有必要浪费资源)
屏幕坐标系和z坐标一起被称作窗口坐标系(Window Coordinates)

### 光栅化阶段
处理场所：GPU
任务：计算每个图元覆盖了哪些像素，并计算它们的颜色
主要流程：三角形设置--->三角形遍历--->片元着色器
#### 三角形设置(Triangle Setup)


#### 三角形遍历


#### 片元着色器


