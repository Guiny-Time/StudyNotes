---
attachments: [Clipboard_2021-09-03-10-40-36.png, Clipboard_2021-09-03-10-40-48.png, Clipboard_2021-09-03-10-43-00.png, Clipboard_2021-09-03-10-44-53.png, Clipboard_2021-09-03-10-50-26.png, Clipboard_2021-09-03-21-43-34.png, Clipboard_2021-09-03-21-43-52.png, Clipboard_2021-09-03-21-45-46.png, Clipboard_2021-09-03-21-45-56.png, Clipboard_2021-09-03-21-47-34.png, Clipboard_2021-09-03-21-47-47.png]
tags: [Unity Shader]
title: §5：透明效果
created: '2021-09-03T00:56:30.077Z'
modified: '2021-09-03T13:49:15.421Z'
---

# §5：透明效果

透明是材质中很重要的一部分，从玻璃到水面到残损的建筑，都多多少少使用到透明效果。常见的达成透明效果的方式有两个：**透明度测试(Alpha Test)**与**透明度混合(ALpha Blend)**
## 透明度测试
这是一种“非黑即白”的方法，当片元不满足条件时，他就会被舍弃，从而造成该区域alpha = 0，达成透明效果。不过需要注意的是，透明度测试**无法实现半透明效果**
透明度测试没有关闭深度写入，这意味着片元的深度值依然会与深度缓冲中的值进行比较，实现不透明区块的覆盖关系
> **深度写入(ZWrite)**
深度写入指的是将片元的深度值(该片元离摄像机的距离)写入深度缓冲区中。在渲染不透明(opaque)物体时，位置相同但深度值不同的片元会让深度值更大的片元不被渲染而达成“覆盖关系”，同时节约资源
### 缺点
- 效果欠佳
透明度测试简单粗暴，只能得到完全透明或者完全不透明的效果(并不能实现半透明效果)，如下图：
![](@attachment/Clipboard_2021-09-03-21-43-34.png)![](@attachment/Clipboard_2021-09-03-21-43-52.png)![](@attachment/Clipboard_2021-09-03-21-45-46.png)![](@attachment/Clipboard_2021-09-03-21-45-56.png)

- 锯齿化边框
我们可以轻易的发现透明度测试得到的效果的边框存在严重的锯齿化效应：
![](@attachment/Clipboard_2021-09-03-21-47-34.png)![](@attachment/Clipboard_2021-09-03-21-47-47.png)
这是由于边界处纹理的透明度的变化精度问题。为了得到更加柔和的透明效果，就可以使用透明度混合

## 透明度混合
这种方法能够得到真正的半透明效果，原理是透明或半透明的部分和颜色缓冲中的值进行混合
透明度混合关闭了深度写入，这意味着我们需要**小心渲染的顺序**。不过对不透明物体来说，深度测试(ZTest)和深度缓冲(只不过是只读的)依然存在，当距离远的时候半透明值不会被混合。
透明度混合关闭深度写入的原因是：因为深度写入的存在，渲染时会剔除被半透明物体遮盖的部分只渲染前面，导致被半透明物体遮挡的物体是不可见的。但是实际上根据常识半透明物体背后的东西是可见的(虽然被遮住了)，所以需要关闭深度写入
> 正确的渲染顺序
>- 渲染不透明物体(开启深度写入和深度测试)
>- 把半透明物体按离摄像机的距离(深度值)排序，从后往前进行渲染并开启深度测试(但是不开起深度写入)
但是这样会造成以下问题：当半透明物体循环重叠时，无法得到正确的排序顺序，会有一个处于类似“一边在上一边在下”的效果：
![](@attachment/Clipboard_2021-09-03-10-43-00.png)![](@attachment/Clipboard_2021-09-03-10-44-53.png)

### Unity内的渲染队列
![](@attachment/Clipboard_2021-09-03-10-50-26.png)
这是为了更加高效的渲染。如上图所示，队列有一个索引号index，索引号越小会越先被渲染
当使用透明度测试的时候，需要在Tags{}中写入"Queue" = "AlphaTest"
当使用透明度混合的时候，需要在Tags{}中写入
```ShaderLab
SubShader{
  Pass{
    Tags{ "Queue" = "Transparent" }
    ZWrite Off
    // 表示该Pass下的代码均属于深度写入关闭状态
    // 当“Zwrite Off”写在SubShader下时，该SubShader下的所有Pass都属于深度写入关闭的状态
  }
}
```

<br>

***
## Shader函数学习：clip与blend
- clip(xx.a - float x)
clip函数的意思是，当xx片元的alpha(a)值小于阈值x时，该片元被完全舍弃，不被渲染。clip用于深度测试
```ShaderLab
// Alpha test 若texColor.a小于_Cutoff,则物体完全透明
clip (texColor.a - _Cutoff);
```

- blend()








