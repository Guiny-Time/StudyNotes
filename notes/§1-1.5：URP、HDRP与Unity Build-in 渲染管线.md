---
attachments: [Clipboard_2021-09-10-14-27-13.png, Clipboard_2021-09-10-14-35-23.png, Clipboard_2021-09-10-22-20-34.png, Clipboard_2021-09-10-22-26-52.png, Clipboard_2021-09-10-22-30-36.png, Clipboard_2021-09-10-22-54-05.png, Clipboard_2021-09-10-23-29-04.png, Clipboard_2021-09-10-23-32-02.png]
tags: [Unity Shader]
title: §1-1.5：URP、HDRP与Unity Build-in 渲染管线
created: '2021-09-09T10:55:05.746Z'
modified: '2021-09-10T16:33:26.683Z'
---

# §1-1.5：URP、HDRP与Unity Build-in 渲染管线
## 内置渲染管线的渲染流水线
流程图如下。其中蓝色的部分为CPU流水线，绿色的部分为GPU流水线。
![](@attachment/Clipboard_2021-09-10-14-27-13.png)
看上去有点复杂，但简单来说就是：
CPU(应用阶段) --> GPU(几何阶段、光栅化阶段) --> 帧缓冲区(结果)
![](@attachment/Clipboard_2021-09-10-14-35-23.png)
当存在多个相机的时候，每个摄像机都会将各自的渲染管线完整的跑一遍。摄像机的优先级是depth参数(数值越小越先渲染，后渲染的会覆盖前渲染的)，由于摄像机的清屏属性(Clear Falg，在检查器中可以看到)，每次渲染的结果会覆盖其他相机的
### CPU阶段
#### 应用程序阶段
**1. 剔除·Culling**
- 视锥体剔除
每个摄像机都有一个**视锥体**(下图中Gizmos标出来的几何体)，它的形状受视场(View of Field)、近裁面(Near Cliping Plans)、远裁面(Far Cliping Plans)和观察窗(Viewport Rect)的影响。
![](@attachment/Clipboard_2021-09-10-22-26-52.png)![](@attachment/Clipboard_2021-09-10-22-30-36.png)
在视锥体剔除阶段，系统会将物体与视锥体进行一个相交检测来判断我们应该绘制哪些物体
> 完全没有相交，表示这个物体处于视锥体之外，摄像机看不见这个物体，不需要绘制它
有部分相交，则表示这个物体一部分在视锥体内，一部分在视锥体外。摄像机只能看到该物体的一部分，我们只需要绘制这部分就好了
由于高面数模型进行视锥体相交检测时会消耗很多性能，所以我们会采取**包围盒**技术。常用的包围盒有包围球、AABB(轴对齐)包围盒和OBB包围盒来替代原物体的面碰撞器
![](@attachment/Clipboard_2021-09-10-22-54-05.png)

- 层级剔除
我们可以给所有物体设置它的层级：
![](@attachment/Clipboard_2021-09-10-23-29-04.png)
并且可以设定相机渲染的层：
![](@attachment/Clipboard_2021-09-10-23-32-02.png)
被排除在外的层不会被渲染，而会被剔除，这就是层级剔除。

- 遮挡剔除
顾名思义，它指的是两个物体相互遮挡时，剔除掉被遮挡部分的渲染。通过防止 Unity 为那些被其他游戏对象完全挡住（遮挡）的游戏对象执行渲染计算，我们可以提升游戏的性能。
其实没这么简单，挺复杂的...之后专门写个介绍的吧

**2. 排序·Sorting**
- 渲染队列
对于每个物体，它的材质的shader给它指定了一个渲染队列的值。当然，你也可以手动更改渲染队列的值。
默认情况下，渲染队列的值越小就越先被渲染。2500是一个分界点，当值小于2500我们认为这个物体是不透明的，而大于2500则是半透明的。
> **当渲染队列的值相同时**
这种情况下，我们使用物体与摄像机近裁面之间的距离作为渲染先后的指标。
当物体处于不透明渲染队列时，物体离摄像机近裁面越近就越先被渲染(不用重复渲染被遮挡的部分，节省性能开销)
当物体处于半透明渲染队列时，物体离摄像机近裁面越远就越先被渲染(远处的半透明物体需要先混合颜色)

**3. 调用SetPress Call**
设置各种渲染状态，告诉GPU使用哪个shader、哪种混合模式

**4. 调用Draw Call**
告诉GPU需要哪些模型数据

### GPU阶段
GPU阶段的渲染管线的内容我们在上一节里提到过了：
![](@attachment/Clipboard_2021-09-10-22-20-34.png)


### 后处理阶段


##
接下来介绍两个对于内置管线的升级管线，即URP(通用渲染管线)和HDRP(高清渲染管线)，二者有所不同。都支持Post-Processing、Shader Graph和VFX(Visual Effect Graph)
### URP
URP的亮点是可以用于2D项目。2D光照能给2D游戏带来炫酷的效果
### HDRP
没有2D效果，相较于URP而言在光照上更为优秀
