---
attachments: [Clipboard_2021-09-01-11-16-28.png]
tags: [Unity Shader]
title: §4.2：凹凸映射
created: '2021-09-01T02:27:57.808Z'
modified: '2021-09-01T03:23:03.241Z'
---

# §4.2：凹凸映射
凹凸映射主要有两种方式，即高度映射(Height Mapping)和法线映射(Normal Mapping)。凹凸映射通过修改物体表面的法线来为物体提供更多细节，使模型看起来更逼真(但不会真的改变模型顶点的位置)
## 高度映射
- 使用储存了强度值(Intensity)的高度图/高度纹理(Height Map)来模拟表面位移，即表面局部的海拔高度。
- 高度纹理通过颜色非常直观的表示了高度，颜色越浅表示表面越向外凸起、颜色越深表示表面越向内凹。
- 高度纹理通过灰度计算得出法线，不能直接得到法线值，需要消耗更多性能

## 法线映射
- 法线纹理通过颜色来表示法线。但由于像素RGB的分量在[0, 1]范围，而法线的分量在[-1, 1]范围，因此需要使用以下公式进行映射：
$$pixel = \frac{normal + 1}{2}$$
- 法线纹理储存在模型空间或模型切线空间中
- 法线纹理(Normal Map)储存的是法线本身，因此使用法线纹理的处理速度比高度纹理更快
### 模型空间的法线纹理(Object-space Normal Map)
记录**模型空间内各点的法线方向**，通过映射公式后得到的法线纹理。模型空间的法线纹理较为直观，可以看出凹凸情况、五颜六色
模型空间的法线纹理有以下几个优缺点：
- 实现简单、表现直观
不需要原始模型的法线/切线信息，只需要记录各个顶点的法线方向
- 缝隙较少、平滑边界
模型空间的法线纹理能够对边界处进行线性插值以获得更平滑的效果
- 低自由度
模型空间的法线纹理是固定的(绝对法线信息)，当模型产生改变便不再合适，也无法应用于UV动画

### 切线空间的法线纹理(Tangent-space Normal Map)
与模型空间的法线纹理不同的是，切线空间的法线纹理记录的是法线的扰动值，或者说偏移量，是一个相对的法线信息。
对于模型的任意一个顶点，我们可以找到一个切平面，其中上面的任意一条直线都是该顶点的切线。对于切平面垂直的直线即该顶点的法线。我们记录的是新的法线较原本法线的偏移量，如下图所示：
![](@attachment/Clipboard_2021-09-01-11-16-28.png)
由于映射公式的特性，切线空间的法线纹理基本是蓝色色调的(当法线并没有任何偏移时也是蓝色)
切线空间的法线纹理有以下几个优缺点：
- 高自由度、可用于UV动画
因为是相对的法线纹理，所以当模型发生变化的时候，也能得到一个合理的效果。并且可以用在水、熔岩这样流动的物体效果上
- 可重用
一张切线空间的法线贴图可用在多个物体上，比如一块砖的六面
- 可压缩
我们可以只储存切线空间的XY分量来推导法线的Z分量。而对于模型空间的法线纹理则必须记录三个分量
